<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<!--
    사용자 관리 SQL 매퍼
    전자정부프레임워크 iBatis 스타일의 예시 코드입니다.
-->
<sqlMap namespace="userDAO">

    <!-- 사용자 목록 조회 -->
    <select id="selectUserList" resultClass="userVO">
        SELECT
            USER_ID as userId,
            USER_NAME as userName,
            EMAIL as email,
            DEPT_ID as deptId,
            USE_YN as useYn,
            REG_DATE as regDate
        FROM TB_USER
        WHERE USE_YN = 'Y'
        ORDER BY REG_DATE DESC
    </select>

    <!-- 사용자 상세 조회 -->
    <select id="selectUser" parameterClass="string" resultClass="userVO">
        SELECT
            USER_ID as userId,
            USER_NAME as userName,
            PASSWORD as password,
            EMAIL as email,
            PHONE as phone,
            DEPT_ID as deptId,
            USE_YN as useYn,
            REG_DATE as regDate,
            MOD_DATE as modDate
        FROM TB_USER
        WHERE USER_ID = #userId#
    </select>

    <!-- 사용자 등록 -->
    <insert id="insertUser" parameterClass="userVO">
        INSERT INTO TB_USER (
            USER_ID,
            USER_NAME,
            PASSWORD,
            EMAIL,
            PHONE,
            DEPT_ID,
            USE_YN,
            REG_DATE
        ) VALUES (
            #userId#,
            #userName#,
            #password#,
            #email#,
            #phone#,
            #deptId#,
            'Y',
            SYSDATE
        )
    </insert>

    <!-- 사용자 수정 -->
    <update id="updateUser" parameterClass="userVO">
        UPDATE TB_USER
        SET
            USER_NAME = #userName#,
            <isNotEmpty property="password">
            PASSWORD = #password#,
            </isNotEmpty>
            EMAIL = #email#,
            PHONE = #phone#,
            DEPT_ID = #deptId#,
            MOD_DATE = SYSDATE
        WHERE USER_ID = #userId#
    </update>

    <!-- 사용자 삭제 (논리 삭제) -->
    <update id="deleteUser" parameterClass="string">
        UPDATE TB_USER
        SET
            USE_YN = 'N',
            MOD_DATE = SYSDATE
        WHERE USER_ID = #userId#
    </update>

    <!-- 사용자 권한 등록 -->
    <insert id="insertUserRole" parameterClass="userRoleVO">
        INSERT INTO TB_USER_ROLE (
            USER_ID,
            ROLE_ID,
            REG_DATE
        ) VALUES (
            #userId#,
            #roleId#,
            SYSDATE
        )
    </insert>

    <!-- 사용자 권한 삭제 -->
    <delete id="deleteUserRole" parameterClass="string">
        DELETE FROM TB_USER_ROLE
        WHERE USER_ID = #userId#
    </delete>

</sqlMap>
